{% extends "master_teacher.html" %}
{% load static %}

{% block content %}

<script src="{% static 'js/navbar.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/navbar.css' %}">
<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/accounts.css' %}">
<link rel="stylesheet" href="{% static 'css/student_results.css' %}">
<link rel="stylesheet" href="{% static 'css/star-rating.css' %}"> <!-- Add the star rating CSS -->

<style>

.icon-container:hover {
    background-color: white;
    color: white;
}
.fa.fa-pencil:hover {
background-color: white;
}


.button-wrapper button.active {
background-color: #5b7cfa;
color: white;
}

/* Updated CSS rule */
.green-progress progress::-webkit-progress-value {
background-color: green !important; /* Set color of progress bar to green */
}





.background-title {
background-color: #5b7cfa; /* Background color */
color: white; /* Text color */
padding: 10px 20px; /* Padding */
border-top-left-radius: 10px; /* Rounded corners for top left */
border-top-right-radius: 10px; /* Rounded corners for top right */
margin-bottom: 20px; /* Spacing from the content */
width: 100%; /* Set width to 100% */
box-sizing: border-box; /* Include padding and border in the width calculation */
margin-top: -50px; /* Reduce top margin to push it closer to the top */
position: absolute; /* Position absolute */
left: 0; /* Align to the left edge of the nearest positioned ancestor */
font-size:small;
}
.progress-main-container {
position: relative;
}

.progress-background-title {
position: absolute;
top: -30px; /* Adjust the top position */
left: 0;
width: 100%;
background-color: #5b7cfa;
color: white;
padding: 10px 20px;
border-top-left-radius: 10px;
border-top-right-radius: 10px;
font-size: small;
}


.progress-container {
margin-bottom: 20px;
margin-top: 20px;
}

::-webkit-scrollbar {
    display: none;
}
.main-container {
    border-radius: 10px;
    background-color: white;
    border: 1px solid #ccc;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    margin-top: 20px;
   
}



.main-container:hover input {
    color: black ;
    background-color: white;
}

.button-wrapper button.active {
    background-color: #5b7cfa;
    color: white;
}

.student-info {
    display: flex;
    align-items: center;
}

.student-info p {
    margin: 0;
}

input {
    border: 1px solid #ccc; /* Add visible border */
    background: transparent;
    width: 100%;
    box-sizing: border-box;
    font-size: 13px;
    padding: 5px; /* Add padding for better visibility */
}

input[readonly] {
    color: black;
}

.module-input-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.module-input-container input, .module-input-container textarea {
    margin: 5px 0;
}

.module-header-container {
display: flex;
justify-content: space-between;
margin-bottom: 10px;
margin-top: 0px;
}

.module-header {
width: 20%; /* Adjust width if needed */
}

.module-input-container {
display: flex;
justify-content: space-between;
margin-bottom: 10px;
}


.module-name {
    width: 20%; /* Reduced width for module name input */
    margin-right: 20px; /* Add margin to the right */
    height: 50px;
    border: 1px solid black; /* Set border with black color */
    border-width: 1px; /* Adjusted border width */
    border-radius: 3px;
}

.module-description {
width: 40%; /* Adjusted width for module description */
margin-right: 145px !important; /* Reduce margin-right to move it to the left */
padding-left: 10px;
border: 1px solid black; /* Set border with black color */
border-width: 1px; /* Adjusted border width */
border-radius: 3px;
}


.module-result {
    width: 20%; /* Set the width for module result */
    height: 60px;
}

.progress-container {
margin-bottom: 20px; /* Adjust the spacing between progress bars */
margin-top: 20px;
}
progress[value] {
    --w: 200px; /* width of the progress bar */
    --background: rgb(234, 234, 234); /* background color */
    --stripes: repeating-linear-gradient(135deg, #0003 0 10px, #0000 0 20px); /* striped pattern */

    /* Define the progress bar color based on practice_completion_percentage */
    {% if practice_completion_percentage < 30 %}
    --color1: red;
    {% elif practice_completion_percentage < 70 %}
    --color1: orange;
    {% elif practice_completion_percentage < 99 %}
    --color1: green;
    {% else %}
    --color1: purple;
    {% endif %}

    /* Apply the defined background and color */
    background:
        var(--background),
        var(--stripes),
        linear-gradient(var(--color1), var(--color1));

    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: none;
    width: var(--w);
    margin: 0 10px;
    border-radius: 10em;
}

progress[value]::-webkit-progress-bar {
    background-color: var(--background); /* Set background color for the progress bar */
    border-radius: 10em; /* Apply border radius */
}

progress[value]::-webkit-progress-value {
    background-image:
        var(--stripes),
        linear-gradient(var(--color1), var(--color1)); /* Apply striped pattern and gradient color */
    border-radius: 10em; /* Apply border radius */
}

progress[value]::-moz-progress-bar {
    background-image:
        var(--stripes),
        linear-gradient(var(--color1), var(--color1)); /* Apply striped pattern and gradient color */
    border-radius: 10em; /* Apply border radius */
}



/* Additional progress bar for repertoire */
progress#progress2 {
    --w: 200px; /* width of the progress bar */
    --background: rgb(234, 234, 234); /* background color */

    /* Define the progress bar color based on repertoire_completion_percentage */
    {% if repertoire_completion_percentage < 30 %}
    --color2: linear-gradient(red, red);
    {% elif repertoire_completion_percentage < 70 %}
    --color2: linear-gradient(orange, orange);
    {% elif repertoire_completion_percentage < 99 %}
    --color2: green;
    {% else %}
    --color2: purple;
    {% endif %}

    /* Apply the defined background and color */
    background:
        var(--background),
        var(--color2);

    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: none;
    width: var(--w);
    margin: 0 10px;
    border-radius: 10em;
}





/* Styling for the progress bar background */
progress#progress2::-webkit-progress-bar {
    border-radius: 10em;
    background: var(--background);
}

/* Styling for the progress bar value */
progress#progress2::-webkit-progress-value {
    background-image:
        var(--stripes),
        linear-gradient(var(--color2), var(--color2)); /* Apply striped pattern and gradient color */
    border-radius: 10em; /* Apply border radius */
}

progress#progress2::-moz-progress-bar {
    border-radius: 10em;
    background: var(--color2);
}

label {
font-size: 20px;
font-weight: bold;
display: block;
margin: 20px 0;
}


/* Add any additional styles here */
.star-rating {
    display: inline-block;
    font-size: 20px;
}
.star-rating input[type="radio"] {
    display: none;
}
.star-rating label {
    float: right;
    color: #ccc;
    padding: 0;
    cursor: pointer;
}
.star-rating label:before {
    content: '\2606'; /* empty star */
    padding: 5px;
}
.star-rating input[type="radio"]:checked ~ label:before {
    content: '\2605'; /* filled star */
    color: #ffc107; /* change color of filled star */
}




    
    /* Add this CSS to your existing stylesheet or a new one */
.checked-yellow {
    color: rgba(255, 217, 0, 0.814);
}

.star-rating input[type="radio"] + label {
            font-weight: normal; /* Default font weight for all labels */
            color: black;
        }

        .star-rating input[type="radio"]#star3 + label,
        .star-rating input[type="radio"]#star4 + label {
            font-weight: normal; /* Bold font weight for 3 stars and 4 stars labels */
            color: black;
        }

</style>

<h1 style="font-size: 20px;" class="slide-in-left">Grading Student Results</h1>

<hr class="slide-in">

<div class="student-info">
    <p>{{ student.studentName }} ></p>
    <p> Book {{ book_id }} > </p>
    <p>  {{ instrument_minor_name }} {{ instrument_major_name }}</p>
</div>

<hr>

{% if messages %}
    <div class="alert alert-success" role="alert">
        {% for message in messages %}
            {{ message }}
        {% endfor %}
    </div>
{% endif %}

<div class="main-container progress-main-container slide-in" style="margin-top: 50px; margin-bottom: 20px;">
    <div class="progress-background-title">Student Academic Progress</div>
    <div class="progress-container">
        <progress id="progress1" value="{{ practice_completion_percentage }}" max="100" style="width: 50%;"></progress>
        <p style="margin-left: 20px; color: black;">Practice : {{ practice_completion_percentage }}% Completed</p>
    </div>
    <div class="progress-container">
        <progress id="progress2" value="{{ repertoire_completion_percentage }}" max="100" style="width: 50%;"></progress>
        <p style="margin-left: 20px; color: black;">Repertoire : {{ repertoire_completion_percentage }}% Completed</p>
    </div>
</div>





<div class="main-container slide-in-left" style="margin-top: 60px;">

    <p class="background-title">Student Progress</p>
    <div class="filter-buttons-container slide-in" style="max-width: 800px; position: relative; margin-top: 20px;">
        <div class="button-wrapper">
            <!-- <button onclick="filterInstruments(this, 'All')" class="active"
                    style="box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); border: 1px solid black;">
                All
            </button> -->
            {% for module_type in module_types %}
            <button onclick="filterInstruments(this, '{{ module_type }}')" data-module-type="{{ module_type }}">
                {{ module_type }}
            </button>
            
            {% endfor %}
        </div>
    </div>

    <hr>

    {% for module, results in results_by_module.items %}
    <div class="module-header-container module-header-{{ forloop.counter }}">
        <div class="module-header">Module {{ forloop.counter }}</div>
        <div class="module-header" style="margin-right: 630px;"></div>
    </div>
    <div class="module-input-container">
        <div style="color: black; font-weight: bold;">{{ module.module_name }}</div>
        <div>{{ module.description }}</div>
        <input type="text" value="{{ module.module_type }}" readonly style="visibility:hidden; width: 0;">
        <div class="module-result" style="margin-right: 40px;">
            {% if results %}
                {% for result in results %}
                    {% if result|add:0 == 3 %}
                        <div class="star-rating">
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <p style="font-size: 14px;">Satisfactory</p>
                        </div>
                    {% elif result|add:0 == 4 %}
                        <div class="star-rating">
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <p style="font-size: 14px;">Good</p>
                        </div>
                    {% elif result|add:0 == 5 %}
                        <div class="star-rating">
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <span class="fa fa-star checked-yellow"></span>
                            <p style="font-size: 14px;">Excellent</p>
                        </div>
                    {% else %}
                        <p style="color: green; margin-top: 20px;"> {{ result }} </p>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p style="margin-bottom: -100px; display: inline;">No result available</p>
                <div class="icon-container"
                     onclick="confirmUpdate(this, '{{ module.module_name }}', '{{ module.description }}', '{{ module.id }}')"
                     data-username="{{ account.username }}" style="margin-left: 30px; border-color: #5b7cfa; display: inline; margin-top: 80px;">
                    <i class="fa fa-pencil" id="updateIcon" style="color: #5b7cfa;"></i>
                </div>
            {% endif %}
        </div>
    </div>
    
    
        
    {% endfor %}  
    <button style="background-color: red; color: white; border-radius: 5px; border: none; height: 40px;width:100px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);">Print Report </button>  
</div>

<!-- Modal -->
<div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <span class="close" >&times;</span>
        <div class="topic-background" style="background-color: #32373d; ">
            <p style="color: white;  padding: 10px; text-align: center; margin-top: 10px; font-weight: 500;">Update Result for <span id="module-name-modal"></span></p>
        </div>
        <p id="module-name-modal"></p>

        <p>Description</p>
        <p id="module-description-modal"></p>
        <!--  -->
        <form id="update-result-form" method="post" action="{% url 'update_student_result' student.studentName %}">
            {% csrf_token %}
            <input type="hidden" name="module_id" id="module-id-input">
            <input type="hidden" name="student_name" value="{{ student.studentName }}">
            <label for="result" style="font-weight: normal;color: black;">Result</label>
            <div class="star-rating">
                <input type="radio" id="star5" name="result" value="5"><label for="star5" title="Excellent">5 stars</label>
                <input type="radio" id="star4" name="result" value="4"><label for="star4" title="Good">4 stars</label>
                <input type="radio" id="star3" name="result" value="3" checked><label for="star3" title="Satisfactory">3 stars</label>
                <input type="radio" id="star2" name="result" value="2" disabled><label for="star2" title="Needs Improvement"></label>
                <input type="radio" id="star1" name="result" value="1" disabled><label for="star1" title="Needs Improvement"></label>
            </div>
            <button type="submit" style="border-radius: 5px;background-color: #5b7cfa;color: white; border: none; width: 20%; height: 50%;margin-left: 200px;">Update</button>
        </form>
    </div>
    <script>
        // Function to filter modules based on module type
        function filterInstruments(button, moduleType) {
            var containers = document.querySelectorAll('.module-input-container');
            var headers = document.querySelectorAll('.module-header-container');
        
            if (moduleType === 'All') {
                containers.forEach(function(container) {
                    container.style.display = 'flex';
                });
                headers.forEach(function(header) {
                    header.style.display = 'flex';
                });
            } else {
                containers.forEach(function(container, index) {
                    var moduleInput = container.querySelector('input[type="text"][value="' + moduleType + '"]');
                    if (moduleInput) {
                        container.style.display = 'flex';
                        headers[index].style.display = 'flex';
                    } else {
                        container.style.display = 'none';
                        headers[index].style.display = 'none';
                    }
                });
            }
        
            document.querySelectorAll('.button-wrapper button').forEach(function(btn) {
                btn.classList.remove('active');
            });
        
            button.classList.add('active');
        }
        
        // Function to filter and show only Practice modules initially
        function showPracticeModules() {
            var practiceButton = document.querySelector('.button-wrapper button[data-module-type="Practice"]');
            if (practiceButton) {
                filterInstruments(practiceButton, 'Practice');
            }
        }
        
        // Event listener for DOMContentLoaded to initialize filter
        document.addEventListener('DOMContentLoaded', function() {
            showPracticeModules();
        });
        
        // Event listener for button clicks to filter modules
        document.querySelectorAll('.button-wrapper button').forEach(function(btn) {
            btn.addEventListener('click', function() {
                filterInstruments(this, this.dataset.moduleType);
            });
        });
        
        // Function to handle modal display and update
        function confirmUpdate(iconContainer, moduleName, moduleDescription, moduleId) {
            var modal = document.getElementById("myModal");
            var span = document.getElementsByClassName("close")[0];
        
            document.getElementById("module-name-modal").textContent = moduleName;
            document.getElementById("module-description-modal").textContent = moduleDescription;
            document.getElementById("module-id-input").value = moduleId;
        
            modal.style.display = "block";
        
            span.onclick = function() {
                modal.style.display = "none";
            };
        }
        </script>
        




{% endblock %}

